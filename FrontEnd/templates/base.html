<!DOCTYPE html>
<html lang="es">

    <head>
        <meta charset="UTF-8">
        <!--Bootstrap-->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">

        <!--Archivo de estilos CSS-->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/contacto_modal.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/registro_inicio_modal.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/buscador_grupos.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/materias.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/grupos.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/compañerxs_sin_grupo.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil_usuario.css') }}">

        <!--Fuentes de texto, las agregamos online porque es muy dificil que se caiga GoogleFonts, ¿aún así tenemos que hacerlo descargarlas?-->
        <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Istok+Web&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Gentium+Book+Plus:ital,wght@0,400;0,700;1,400;1,700&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Gentium+Book+Plus:ital,wght@0,400;0,700;1,400;1,700&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&family=Poetsen+One&display=swap" rel="stylesheet">
        <!--Fin fuentes de texto-->

        <link rel="icon" href="{{ url_for('static', filename='/img/iconos/logo.png', _external=True) }}">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>{% block title %}{% endblock %}</title>
    </head>


    <body>
        
        <header class="pt-5">
            <div class="container-fluid d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">        
                <div id="contenedor-logo-header" class="d-flex flex-column align-items-center gap-2 mb-2 mx-5 px-5 justify-content-center text-center">
                    <a href="/" class="text-decoration-none text-center"><img src="{{ url_for('static', filename='img/iconos/logo.png') }}" alt="Logo" class="img-fluid">
                        <h4 class="text-white mb-0 fw-bold">TP BUDDY</h4>
                    </a>
                </div>
                <div id="contenedor-botones-header" class="d-flex flex-wrap gap-2 justify-content-center align-items-center mx-5 px-5">
                    {% if session['usuario'] %}
                        <a  href="/usuario/{{ session['usuario'] }}"><img src="{{ url_for('static', filename='img/iconos/perfil.png') }}" alt="Perfil" width="30" height="30"></a>
                        <a href="/usuario/{{ session['usuario'] }}" class="btn btn-sm">MI PERFIL</a>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#modalSolicitudesPendientes">
                            {% if session['notificacion'] %}
                                <img src="{{ url_for('static', filename='img/iconos/notificacion.png') }}" alt="Notificaciones" width="30" height="30">
                            {% endif %}
                        </a>
                        <a href="{{ url_for('cerrar_sesion') }}" id="btn_cerrar_sesion" class="btn btn-sm">CERRAR SESIÓN</a>
                    {% else %}
                        <a href="#" id="btn-registrarse" class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#registroModal">REGISTRARSE</a>
                        <a href="#" id="btn-iniciar-sesion" class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal">INICIAR SESIÓN</a>
                    {% endif %}
                </div>
            </div>
        </header>

        <div>
            <nav class="navbar navbar-expand-md px-3">
                <div class="container-fluid justify-content-center">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu"
                        aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
                        <img src="{{ url_for('static', filename='img/iconos/navbar-button.png') }}" alt="" width="30" height="30">
                    </button>
                    <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
                        <ul class="navbar-nav gap-2" id="opciones-menu">
                            <li class="nav-item mx-5"><a class="nav-link fw-bold" href="/#como-funciona">Cómo funciona</a></li>
                            <li class="nav-item mx-5"><a class="nav-link fw-bold" href="{{ url_for('mostrar_materias') }}">Materias</a></li>
                            <li class="nav-item mx-5"><a class="nav-link fw-bold" href="{{ url_for('mostrar_grupos') }}">Grupos</a></li>
                            <li class="nav-item mx-5" onclick="mostrarPopupContacto()" ><a class="nav-link fw-bold">Contactanos</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        {% if error %}
            <div class="d-flex justify-content-center align-items-center mt-3">
                <div class="border-0 w-50 alert alert-danger text-white text-center mx-5 px-0">{{ error }}</div>
            </div>
        {% endif %}


        <main class="container-fluid px-0">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10 px-0">
                    {% block content %}{% endblock %}
                </div>
            </div>
        </main>

        <footer class="mt-5 pt-4 pb-2">
            <div class="container">
                <div class="row d-flex flex-column justify-content-center text-center align-items-center" id="contenedor-footer">
                    <div id="contenedor-logo-footer" class="col-12 mb-3 mb-md-0 d-flex flex-column align-items-center justify-content-center gap-2">
                        <img id="img-footer" src="{{ url_for('static', filename='img/iconos/logo-blanco-negro.png') }}" alt="Logo Footer"> 
                        <h4 class="mb-0">TP BUDDY</h4>
                    </div>
                    <div class="col-12 mb-3 mb-md-0">
                        <ul class="nav my-2 d-flex justify-content-center" id="listado-footer">
                            <li class="nav-item mx-4"><a class="text-decoration-none" href="/">Inicio</a></li>
                            <li class="nav-item mx-4"><a class="text-decoration-none" href="/#como-funciona">Cómo funciona</a></li>
                            <li class="nav-item mx-4"><a class="text-decoration-none" onclick="mostrarPopupContacto()">Contactanos</a></li>
                        </ul>
                    </div>
                    <div class="col-12 d-flex flex-column align-items-center">
                        <p class="mb-1">Términos y condiciones</p>
                        <p class="mb-0">2025@</p>
                    </div>
                </div>
            </div>
        </footer>


        <!-- Modales -->
        <div class="modal fade" id="registroModal" tabindex="-1" aria-labelledby="registroModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg-custom">
            <div class="modal-content modal-dark p-4">
                <div class="modal-body">
                <h5 class="custom-title fw-bold mb-4">¡Bienvenid@!</h5>
        
                <form method="POST" action="{{ url_for('registrarse') }}">
                    <!-- Número de padrón -->
                    <div class="mb-3 w-100">
                    <label for="padron" class="text-white">Número de padrón</label>
                    <input type="text" class="form-control form-dark" id="padron" name="padron" placeholder="Escribí acá tu número de padrón">
                    </div>
        
                    <!-- Contraseña -->
                    <div class="mb-3 position-relative w-100">
                    <label for="register-password" class="text-white">Contraseña</label>
                    <input type="password" class="form-control input-dark ps-5 pe-5" id="register-password" name="password" placeholder="Contraseña">
                    <i class="fas fa-lock icon-left"></i>
                    <i class="far fa-eye icon-right" id="togglePassword" onclick="togglePasswordVisibility()"></i>
                    </div>
        
                    <!-- Nombre -->
                    <div class="mb-3 w-100">
                    <label for="nombre" class="text-white">Nombre completo</label>
                    <input type="text" class="form-control form-dark" id="nombre" name="nombre" placeholder="Escribí acá tu nombre">
                    </div>
        
                    <!-- Botón -->
                    <div class="d-grid w-100">
                    <button type="submit" class="btn btn-dark btn-submit">Registrate</button>
                    </div>
                </form>
                </div>
            </div>
            </div>
        </div>


        <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-dark p-4">
            <div class="modal-body">
                <h5 class="custom-title fw-bold mb-4">¡Bienvenid@!</h5>

                <form method="POST" action="{{ url_for('iniciar_sesion') }}">
                <!-- Número de padrón -->
                <div class="mb-3 w-100">
                    <label for="login-padron" class="text-white">Número de padrón</label>
                    <input type="text" class="form-control form-dark" name="padron" id="login-padron" placeholder="Escribí acá tu número de padrón">
                    <input type="hidden" name="next" value="{{ request.path }}">
                </div>

                <!-- Contraseña -->
                <div class="mb-3 position-relative w-100">
                    <label for="login-password" class="text-white">Contraseña</label>
                    <input type="password" class="form-control input-dark ps-5 pe-5" id="login-password" name="password" placeholder="Contraseña">
                    <i class="fas fa-lock icon-left"></i>
                    <i class="far fa-eye icon-right" id="toggleLoginPassword" onclick="toggleLoginPasswordVisibility()"></i>
                </div>

                <!-- Botón -->
                <div class="d-grid w-100">
                    <button type="submit" class="btn btn-dark btn-submit">Iniciar sesión</button>
                </div>
                </form>
            </div>
            </div>
        </div>
        </div>

        <!-- Contacto -->
        <div onclick="cerrarPopupContacto()" id="fondo_popup_contacto"></div>

        <div id="contenedor_contacto_popup">
            <h3>Contacto</h3>
            <div id="contenedor_lista_correos">
                <div class="mail">cvperezb@fi.uba.ar</div>
                <div class="mail">myaque@fi.uba.ar</div>
                <div class="mail">aoshiro@fi.uba.ar</div>
                <div class="mail">lcoroq@fi.uba.ar</div>
                <div class="mail">sbardina@fi.uba.ar</div>
                <div class="mail">samartin@fi.uba.ar</div>
            </div>
            <form action="">
                <label for="email">Ingrese su correo: </label><br>
                <input type="email" name="email" id="email" autocomplete="email"><br>

                <label for="mensaje">Mensaje: </label>
                <textarea type="text" name="mensaje" id="mensaje"></textarea>

                <div id="contenedor_botones_enviar_cerrar">
                    <button type="submit" id="btn_enviar">Enviar</button>
                    <button type="button" id="btn_cerrar" onclick="cerrarPopupContacto()">Cerrar</button>
                </div>
            </form>
        </div>


        <!-- Modal de Solicitudes Pendientes -->
        <div class="modal fade" id="modalSolicitudesPendientes" tabindex="-1" aria-labelledby="modalSolicitudesPendientesLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content modal-dark p-4">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="modalSolicitudesPendientesLabel">Solicitudes pendientes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                {% if solicitudes_pendientes | length > 0 %}
                <ul class="list-group gap-3 rounded-4">
                    {% for solicitud in solicitudes_pendientes %}
                    <li class="list-group-item solicitud-item border-0">
                        <div class="row g-2 align-items-center text-center fw-lighter">
                        <div class="col-12 col-md-4">
                            {% if solicitud.tipo == 'usuario_a_grupo' %}
                                <p>{{ solicitud.nombre_emisor | capitalize }} ({{ solicitud.padron_emisor }}) quiere unirse a tu grupo {{ solicitud.grupo_nombre }}
                                de la materia {{ solicitud.materia_nombre }} </p>
                            {% elif solicitud.tipo == 'grupo_a_usuario' %}
                                <p>El grupo {{ solicitud.grupo_nombre }}
                                de la materia {{ solicitud.materia_nombre }}
                                con integrantes:</p>
                                <ul class="list-unstyled mb-0">
                                    {% for integrante in solicitud.integrantes %}
                                        <li>{{ integrante.nombre }} ({{ integrante.padron }})</li>
                                    {% endfor %}
                                </ul>
                                <p>quiere que te unas a su grupo.</p>
                            {% elif solicitud.tipo == 'usuario_a_usuario' %}
                                <p>{{ solicitud.nombre_emisor | capitalize }} ({{ solicitud.padron_emisor }}) quiere formar un grupo con vos para la materia {{ solicitud.materia_nombre }}.</p>
                            {% endif %}
                        </div>
                        <div class="col-12 col-md-4">
                            {% if solicitud.tipo == 'usuario_a_grupo' %}
                                <p>Sus horarios disponibles son:</p>
                                <ul class="list-unstyled mb-0">
                                    {% for dia in ['lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado', 'domingo'] %}
                                        {% for turno in solicitud.horarios_emisor[dia] %}
                                            <li>{{ dia|capitalize }} - {{ turno }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            {% elif solicitud.tipo == 'grupo_a_usuario' %}
                                <p>Horarios disponibles del grupo:</p>
                                <ul class="list-unstyled mb-0">
                                {% for dia in ['lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado', 'domingo'] %}
                                    {% for turno in solicitud.horarios_grupo[dia] %}
                                        <li>{{ dia|capitalize }} - {{ turno }}</li>
                                    {% endfor %}
                                {% endfor %}
                                </ul>
                            {% elif solicitud.tipo == 'usuario_a_usuario' %}
                                <p>Sus horarios disponibles son:</p>
                                <ul class="list-unstyled mb-0">
                                    {% for dia in ['lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado', 'domingo'] %}
                                        {% for turno in solicitud.horarios_emisor[dia] %}
                                            <li>{{ dia|capitalize }} - {{ turno }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                        <div class="col-12 col-md-4 text-center">
                            <form method="POST" action="/solicitud/{{ solicitud.solicitud_id }}/aceptar" class="d-inline">
                            <button type="submit" class="btn btn-success btn-sm mb-1">Aceptar</button>
                            </form>
                            <form method="POST" action="/solicitud/{{ solicitud.solicitud_id }}/rechazar" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm mb-1">Rechazar</button>
                            </form>
                        </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No tenés solicitudes pendientes.</p>
                {% endif %}
            </div>
            </div>
        </div>
        </div>


        <!-- Bootstrap-->
        <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/script.js') }}"></script>


    </body>

</html>